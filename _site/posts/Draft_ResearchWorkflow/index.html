<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-04-15">
<meta name="description" content="Notes on notes">

<title>Research Workflow – Katherine Hayes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-50f0e86957463372b17f1dd0b860f020.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Katherine Hayes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.pdf"> 
<span class="menu-text">CV</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Research Workflow</h1>
            <p class="subtitle lead">How I structure my notes and citations</p>
                  <div>
        <div class="description">
          Notes on notes
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Workflow</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 15, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">June 17, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#the-tools" id="toc-the-tools" class="nav-link active" data-scroll-target="#the-tools">The Tools</a>
  <ul class="collapse">
  <li><a href="#saving-filing-and-reading-articles" id="toc-saving-filing-and-reading-articles" class="nav-link" data-scroll-target="#saving-filing-and-reading-articles">Saving, filing and reading articles</a></li>
  </ul></li>
  <li><a href="#the-notetaking" id="toc-the-notetaking" class="nav-link" data-scroll-target="#the-notetaking">The Notetaking</a>
  <ul class="collapse">
  <li><a href="#reference-notes" id="toc-reference-notes" class="nav-link" data-scroll-target="#reference-notes">Reference notes</a></li>
  <li><a href="#concept-notes" id="toc-concept-notes" class="nav-link" data-scroll-target="#concept-notes">Concept notes</a></li>
  <li><a href="#project-notes" id="toc-project-notes" class="nav-link" data-scroll-target="#project-notes">Project notes</a></li>
  </ul></li>
  <li><a href="#the-weeds" id="toc-the-weeds" class="nav-link" data-scroll-target="#the-weeds">The weeds</a>
  <ul class="collapse">
  <li><a href="#obsidian-templates" id="toc-obsidian-templates" class="nav-link" data-scroll-target="#obsidian-templates">Obsidian templates</a></li>
  <li><a href="#connecting-reference-notes-to-zotero" id="toc-connecting-reference-notes-to-zotero" class="nav-link" data-scroll-target="#connecting-reference-notes-to-zotero">Connecting reference notes to zotero</a></li>
  </ul></li>
  <li><a href="#more-resources" id="toc-more-resources" class="nav-link" data-scroll-target="#more-resources">More resources</a>
  <ul class="collapse">
  <li><a href="#some-examples-of-similar-workflows" id="toc-some-examples-of-similar-workflows" class="nav-link" data-scroll-target="#some-examples-of-similar-workflows">Some examples of similar workflows:</a></li>
  <li><a href="#a-full-list-of-tools" id="toc-a-full-list-of-tools" class="nav-link" data-scroll-target="#a-full-list-of-tools">A full list of tools</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<p>I’ve played around with many different research workflows over the years - physical notebooks, notes stored in infinite word documents, color-coded index cards when I was a brand new undergraduate writing my first research paper. I’ve gone back and forth since then about whether following a system is a really important tool or whether it’s a particularly creative procrastination technique. I’d like to think I’ve found a middle ground. My current system is automated as much as possible to cut down on the busy work of maintaining the workflow itself.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Vault_Snapshot.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">A current snapshot of my obsidian vault / annotated bibliography</figcaption>
</figure>
</div>
<section id="the-tools" class="level1">
<h1>The Tools</h1>
<p><strong>In a sentence:</strong> I use Obsidian, paired with zotero, to index notes in what I’d call an extremely modified <a href="https://zettelkasten.de/introduction/">zettelkasten</a> approach.</p>
<p><strong>In more than a sentence:</strong> I keep notes on each article I read, linking concepts between them, and pulling together more in-depth thoughts in longer notes. Obsidian lets me save each note as a markdown file, indexed by the relevant reference in Zotero.</p>
<section id="saving-filing-and-reading-articles" class="level2">
<h2 class="anchored" data-anchor-id="saving-filing-and-reading-articles">Saving, filing and reading articles</h2>
<p>I import articles into zotero using <a href="https://www.zotero.org/download/">the chrome extension</a>, organize it roughly in a folder, and read it in PDF form within zotero on a tablet (which, now thanks to Zotero 6, syncs and saves highlights and annotations across devices).</p>
<p>From there, the <a href="https://github.com/hans/obsidian-citation-plugin">Citations plug-in</a> allows me to link my Obsidian notes to the zotero entry using citekeys generated by <a href="https://retorque.re/zotero-better-bibtex/">betterbibtex</a>.</p>
</section>
</section>
<section id="the-notetaking" class="level1 page-columns page-full">
<h1>The Notetaking</h1>
<p>So much has been written about the value of notetaking for knowledge production.</p>
<p>One of my favorite takes is <a href="https://docdrop.org/download_annotation_doc/How-to-Take-Smart-Notes-by-So%CC%88nke-Ahrens-40zol.pdf">How to take Smart Notes</a> by Sönke Ahrens which positions notetaking as an integral (maybe <em>the</em> integral) step of nonfiction or research writing. For me, building a system for notes has always felt like a key way to focus on process, not outcome - knowledge production as a job can at best feel for me like endless opportunity, and at worst feels like an enormous sisyphus-ian void. Maintaining an annotated bibliography means I’m more likely to write every day, in some form, about something.</p>
<p>Once my citations are filed into zotero and I’ve updated all the fidly little plug-ins so obsidian and zotero are talking, then we get into the fun bits<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;I’m a good time at parties, I swear</p></div></div><p>I use three different types of notes: Reference Notes, Concept Notes and Project Notes.</p>
<section id="reference-notes" class="level3">
<h3 class="anchored" data-anchor-id="reference-notes">Reference notes</h3>
<p>I create Reference notes for the scientific papers I read - I try to follow a structure once assigned to me as a graduate student: a paragraph or two summarizing the article, a paragraph reviewing my own thoughts as I read, a sentence of takeaways and whatever citations I’d like to keep track of in a bulleted list at the end. Reviewing an article in that way can be an undertaking - I have a lot of notes in some stage of completion, and many for which a full summary might be overkill.</p>
</section>
<section id="concept-notes" class="level3">
<h3 class="anchored" data-anchor-id="concept-notes">Concept notes</h3>
<p>I create Concept notes that connect the ideas and concepts between reference notes - some of them are just tags (<em>boreal</em>, <em>fire</em>, <em>herbivory</em>), others turn into quick notes to mark definitions (words I had to look up, things like <em>autotrophic respiration</em> or <em>thermophilization</em>), and some end up as deep file drawers (like <em>moose</em>, which is a long list of average body weight, home range sizes, preferred forage species and other values I think I might use as parameters or citations some day).</p>
</section>
<section id="project-notes" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="project-notes">Project notes</h3>
<p>I start to create project notes to keep track of broader concepts that emerge across journal papers and concepts. I have project notes named things like are named things like <em>How does climate change alter the dynamics of biotic disturbances?</em> Or S<em>hrub expansion in the Arctic</em> - ideas I’ve started to pull together across articles.</p>
<div class="quarto-figure quarto-figure-right">
<figure class="figure">
<p><img src="ProjectNotes.png" class="img-fluid quarto-figure quarto-figure-right figure-img"></p>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is the stage where the zettelkastan method guides start to describe spontaneous idea generating - some mystical point at which all the notes start to connect in interesting ways. Depending on the blog post, sometimes the zettelkastan can feel like a sales pitch, one where the “papers just write themselves!”. I have some skepticism around this - but I do agree that so far it’s been really useful to have a place to sort out some of these growing ideas. Some of my more developed project notes have started to read like the introduction to a literature review or a talk, which is exciting.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="Moose_Network.png" class="img-fluid figure-img"></p>
<figcaption class="margin-caption">Some of my notes on moose</figcaption>
</figure>
</div>
</section>
</section>
<section id="the-weeds" class="level1">
<h1>The weeds</h1>
<p><em>Some workflow specifics, in no particular order</em></p>
<section id="obsidian-templates" class="level3">
<h3 class="anchored" data-anchor-id="obsidian-templates">Obsidian templates</h3>
<p>Obsidian lets you create templates for different types of notes, stored in the Template folder in your vault. I have one for each note type [visualize]</p>
<p>For a while, I would sort things into folders automatically, which I thought would incentivize me to finish notes I hadn’t sorted yet. But then the vault filled with so many unfinished notes that it made it hard to navigate. Now I’ve got Hazel set up to sort things automatically based on their tags, which helps.</p>
</section>
<section id="connecting-reference-notes-to-zotero" class="level3">
<h3 class="anchored" data-anchor-id="connecting-reference-notes-to-zotero">Connecting reference notes to zotero</h3>
<p>To connect my reference notes in obsidian to zotero, I use three plugins:</p>
<ol type="1">
<li>the <strong>citations</strong> community plugin in obsidian</li>
<li>the BetterBibText</li>
<li>MarkDBConnect</li>
</ol>
<p><strong>Citations</strong></p>
<p>I use their short citation (Author, Year) as the title and link each to their corresponding zotero entry using a citekey (the method for which is described further in the documentation for the plugin Citations). It’s not a perfect automation - sometimes I have to go in and manually edit the citekey to match the one in obsidian. I also had to change the obsidian settings to be XX, and the one in zotero is set as XX.</p>
<p>Some notes: Zotero crashes pretty regularly on me - aka, every first time I open it. My guess is it’s the extra add-ins and extensions, but I’ve been too lazy to double check or to look for a solution.</p>
</section>
</section>
<section id="more-resources" class="level1">
<h1>More resources</h1>
<section id="some-examples-of-similar-workflows" class="level2">
<h2 class="anchored" data-anchor-id="some-examples-of-similar-workflows">Some examples of similar workflows:</h2>
<ul>
<li>https://martinezponciano.es/2021/04/05/research-workflow-as-a-phd-student-in-the-humanities/</li>
<li>https://wippp.com/blog/taekman-zettelkasten-workflow-2023-using-devonthink-drafts-and-obsidian</li>
<li>https://nicolevanderhoeven.com/blog/20210518-how-i-use-obsidian-at-work/#the-easier-way</li>
<li>https://thesiswhisperer.com/2023/02/01/building-a-second-brain-for-writing-with-obsidian/</li>
<li>https://notes.nicolevanderhoeven.com/obsidian-playbook/Using+Obsidian/01+First+steps+with+Obsidian/Obsidian</li>
<li>https://notes.nicolevanderhoeven.com/sources/Presentation/Mine/The+Lost+Art+of+Taking+Good+Notes</li>
</ul>
</section>
<section id="a-full-list-of-tools" class="level2">
<h2 class="anchored" data-anchor-id="a-full-list-of-tools">A full list of tools</h2>
<ul>
<li><p>Obsidian</p></li>
<li><p><a href="https://github.com/hans/obsidian-citation-plugin">Obsidian Citation plug in</a></p></li>
<li><p><a href="https://retorque.re/zotero-better-bibtex/">betterbibtex</a> - creates citekeys that link zotero items to obsidian notes</p></li>
<li><p>Zotero</p></li>
<li><p><a href="https://www.zotero.org/download/">Zotero Chrome Extension</a> - saves articles to zotero libraries within Chrome</p></li>
</ul>


</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="k8hayes/BlogComments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->




</body></html>