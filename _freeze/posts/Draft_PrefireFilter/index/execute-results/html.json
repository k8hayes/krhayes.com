{
  "hash": "9f4812c9beffb07f16ef6da052901174",
  "result": {
    "markdown": "---\ntitle: Do starting points matter?\nsubtitle: Sensitivity test of pre-fire stand composition\ndate: today\ncategories: []\ndate-modified: last-modified\ndraft: true\nformat:\n  html:\n    embed-resources: true\n---\n\n\nTo compare my model output to exclosure data, I'd like to find data on the relationship between age and growth in stands that burned at high-severity.\n\nUsing iLand output like *fraction of crownkill* and *basal area consumed* didn't work well for this question, since they both aggregate to the scale of the resource unit, and I kept ending up with trees that slipped through and weren't killed in the fire, complicating the age-growth relationships. Instead, I've figured out how to take the stand output and look at the years before and after fire to find the resource unit IDs, and then I pull out the stand and sapling data for just those resource units.\n\nI'm currently filtering by the following conditions:\n\n-   experienced 1 fire (and only 1 fire) in the 100 year simulation\n\n-   contained stands and saplings in the resource unit in the year before the fire (TSF = -1)\n\n-   had no trees or saplings in the year of the fire (TSF = 0)\n\n-   had no trees or saplings in the year following the fire (TSF = 1)\n\nIn practice it looks something like this:\n\n::: column-margin\nHere's part\\* of the code I'm using to filter the output:\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n prefireStand <- stand %>%\n    filter(TSF == -1 & # only TSF from year b4 fire\n             count_ha > 0 & NPPabove_kg > 0 & # only rids with biomass b4 fire\n             cohort_count_ha > 0 & cohort_basal_area > 0) %>%\n    distinct(rid, .keep_all = TRUE) # find unique rids\n  \n  postfireStand <- stand %>%\n    filter(TSF == 1 & count_ha == 0 & height_avg_m == 0 & NPPabove_kg == 0) %>%\n    distinct(rid, .keep_all = TRUE)\n  \n  fireStand = stand %>%\n    filter(TSF == 0 & count_ha == 0 & height_avg_m == 0 & NPPabove_kg == 0) %>%\n    distinct(rid, .keep_all = TRUE)\n  \n  RID = postfireStand %>%\n    filter(rid %in% prefireStand$rid, rid %in% fireStand$rid) %>%\n    pull(rid) %>%\n    unique()\n  \n  stand = stand %>%\n    filter(rid %in% RID,\n           cohort_id %in% postfireStand$cohort_id,\n           TSF > 0,\n           count_ha > 0) %>%\n    select(c(year, ru, rid, species, count_ha,\n             height_avg_m, dbh_avg_cm, basal_area_m2, TSF))\n```\n:::\n\n\n::: column-margin\n\\*Not included is the code that finds stands that burned once and only once, that's a bit lengthy and I'm confident it's working the way I want\n:::\n\nFollowing that, I wanted to test out how much the prefire stand composition matters for the age growth relationships of different species.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n# Sensitivity test\n\nI'm using 3 approaches:\n\n1.  Not filtering by pre-fire composition at all\n\n2.  Selecting just the stands with a spruce importance value of 0.5 or more\n\n3.  Selecting just the stands with a spruce importance value of 0.9 or more\n\n::: column-margin\nI tried a spruce importance value of 1, but in many of the replicates there weren't any stands that met that criteria at all.\n:::\n\n# How much does prefire stand composition matter?\n\nAll of the following is from runs of moose, hare, moose + hare and no moose/hare under historic climate, using the POLE-FM parameters and replicated 10x.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot birch-1.png){width=672}\n:::\n:::\n\n \nLooks like birch doesn't persist in the later decades after fire in the stands that were mature black spruce prior to burning without herbivores. that seems counter-intuitive to me?\n \n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot aspen-1.png){width=672}\n:::\n:::\n\n\nAspen ends up much taller following fire in spruce stands, and it's taller in the scenarios with browsing, which again, seems like the opposite of what I'd expect\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot spruce-1.png){width=672}\n:::\n:::\n\n\nThis looks like there's some spruce that slipped through the filters - I don't fully understand how spruce could have a height of 0 in TSF = 0 and TSF = 1, but appear at 4 meters in TSF = 2.\n\nI'll clip for now: \n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n  filter(species == \"Pima\") %>%\n  filter(Scenario != \"Hare\") %>%\n  filter(Scenario != \"Moose\") %>%\n  filter(TSF > 2) %>%\n  ggplot() +\n  geom_line(aes(x = TSF, y = height, col = Scenario)) + \n  xlim(c(0,50)) + \n  geom_ribbon(aes(x = TSF, ymin = low, \n                    ymax = high, fill = Scenario),\n              alpha = 0.3) +\n    scale_color_manual(values = c(\"#a6611a\", \"#018571\")) + \n  geom_hline(yintercept = 0, linetype = \"dashed\") + \n    labs(x = \"Time since fire (years)\", y = \"Av. Height (m)\",\n         title =\"Spruce\") + \n  scale_fill_manual(values = c(\"#a6611a\", \"#018571\")) +\n  facet_wrap(~filter)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot spruce TSF2-1.png){width=672}\n:::\n:::\n\n\nOkay, so pre-fire stand conditions don't matter much for spruce growth - makes sense, since it's set up to grow steady/incrementally. But somehow it's slightly taller in the scenario without browsing, even though neither herbivore actually browse black spruce. This is making me think I need to chat with Juha/Kati. \n\n# Does the herbivore matter?\n\nHere's the same data but now broken out by herbivore:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot all birch-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot all aspen-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/plot all spruce-1.png){width=672}\n:::\n:::\n\n\nOverall, similar broad trends. Herbivore guild doesn't differ too much in their impacts - the biggest thing I can pick out is that aspen is taller earlier when browsed by hare and not moose. Makes sense. \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}